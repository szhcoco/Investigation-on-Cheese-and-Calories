<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=9621dfbe955dbdb785b835d4173891a204804994" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Investigation on the Relationship Between the Existence of Cheese in Ingredients and Calories | Investigation-on-Cheese-and-Calories</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Investigation on the Relationship Between the Existence of Cheese in Ingredients and Calories" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="Investigation-on-Cheese-and-Calories" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Investigation on the Relationship Between the Existence of Cheese in Ingredients and Calories" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","headline":"Investigation on the Relationship Between the Existence of Cheese in Ingredients and Calories","name":"Investigation-on-Cheese-and-Calories","url":"http://localhost:4000/"}</script>
<!-- End Jekyll SEO tag -->


    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="http://localhost:4000/">
          <h1>Investigation-on-Cheese-and-Calories</h1>
        </a>
        <h2></h2>
        
          <a href="https://github.com/szhcoco/Investigation-on-Cheese-and-Calories" class="button"><small>View project on</small> GitHub</a>
        
        
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1 id="investigation-on-the-relationship-between-the-existence-of-cheese-in-ingredients-and-calories">Investigation on the Relationship Between the Existence of Cheese in Ingredients and Calories</h1>

<p><strong>Name(s)</strong>: Huiting Chen, Coco Sun</p>

<p><strong>Website Link</strong>: <a href="https://szhcoco.github.io/Investigation-on-Cheese-and-Calories/">website</a></p>

<h2 id="overview">Overview</h2>
<p>This is a data science project conducted at UCSD, aiming to investigate on the relationship between the presence of cheese in ingredients and the value of calories. We will walk through the process of data cleaning, checking for missingness dependency, hypothesis testing, building and improving regression models for predictions, as well as performing fairness analysis, to explore the level of significance of cheese and other nutritions that contribute to calories.</p>

<h2 id="introduction">Introduction</h2>
<p>As a dairy made from milk, cheese is rich in nutritions that are essential in maintaining and improving health. The major nutritions include calcium for the growth of bones and teeth, protein that support the development and repair of bone tissues, and vitamins like A and B12 as sources of healthy fat. The nutritions cheese contains determine its importance for people of all ages, and esepcially for children who are in the phase of developing bones and muscles.</p>

<p>In addition to its functionality contributing to health, cheese in food tickles our taste buds and can be added into salads, noodles (Mac &amp; Cheese!), rice, any proteins, pizza, soup… literally anything to make the meal delicious!</p>

<p>The datasets from a <a href="https://www.food.com/">recipe recommendation website</a>, containing recipes and their ratings since 2008. The Food website
offers a massive collecion of recipes categorized by popularity, ingredients, cuisines, and meal type. It serves as a platform where recipes are published with photos where people could comment, reply, and post photos to show their work after trying them. It also contains information about ingredients thus we are able to identify recipes containing cheese.</p>

<p>Despite its popularity and importance as an ingredient for food, concerns have been raised about the health issues related to cheese. In addition to its nutritions, cheese are considered as a high-calory ingredient, and over consumption of high-calory food may lead to increase in weight and obesity, diabetes, or heart disease that would risk life.</p>

<p>Our goal in this project is to answer the question of <strong>whether food with cheese tends to have high calories</strong>, as well as to identify nutritions that play an important role in determining the calories of a recipe. By examining the relationship between nutritions and calories, we will provide insights for home cooks to find appealling recipes, enjoying their food while eating healthily, assist creations of balanced meals, and guide food platforms in improving their recommendation system. Based on the diversity and the large volumn of recipes that the website provides, we consider it as a representative dataset for further analysis.</p>

<h4 id="introduction-to-the-columns">Introduction to the Columns</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RAW_recipes</code> dataset: 83,782 rows and 10 columns, containing information about each recipe.</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Column</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">‘name’</td>
      <td style="text-align: left">Recipe name</td>
    </tr>
    <tr>
      <td style="text-align: center">‘id’</td>
      <td style="text-align: left">Recipe ID</td>
    </tr>
    <tr>
      <td style="text-align: center">‘minutes’</td>
      <td style="text-align: left">Minutes to prepare recipe</td>
    </tr>
    <tr>
      <td style="text-align: center">‘contributor_id’</td>
      <td style="text-align: left">User ID who submitted this recipe</td>
    </tr>
    <tr>
      <td style="text-align: center">‘submitted’</td>
      <td style="text-align: left">Date recipe was submitted</td>
    </tr>
    <tr>
      <td style="text-align: center">‘tags’</td>
      <td style="text-align: left">Food.com tags for recipe</td>
    </tr>
    <tr>
      <td style="text-align: center">‘nutrition’</td>
      <td style="text-align: left">Nutrition information in the form [calories (#), total fat (PDV), sugar (PDV), sodium (PDV), protein (PDV), saturated fat (PDV), carbohydrates (PDV)]; PDV stands for “percentage of daily value”</td>
    </tr>
    <tr>
      <td style="text-align: center">‘n_steps’</td>
      <td style="text-align: left">Number of steps in recipe</td>
    </tr>
    <tr>
      <td style="text-align: center">‘steps’</td>
      <td style="text-align: left">Text for recipe steps, in order</td>
    </tr>
    <tr>
      <td style="text-align: center">‘description’</td>
      <td style="text-align: left">User-provided description</td>
    </tr>
  </tbody>
</table>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RAW_interactions</code> dataset: 731,927 rows and 5 columns, recording users’ ratings and comments for different recipes.</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Column</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">‘user_id’</td>
      <td style="text-align: left">User ID</td>
    </tr>
    <tr>
      <td style="text-align: center">‘recipe_id’</td>
      <td style="text-align: left">Recipe ID</td>
    </tr>
    <tr>
      <td style="text-align: center">‘date’</td>
      <td style="text-align: left">Date of interaction</td>
    </tr>
    <tr>
      <td style="text-align: center">‘rating’</td>
      <td style="text-align: left">Rating given</td>
    </tr>
    <tr>
      <td style="text-align: center">‘review’</td>
      <td style="text-align: left">Review text</td>
    </tr>
  </tbody>
</table>

<p>To address our problem, we need to focus on column <code class="language-plaintext highlighter-rouge">nutrition</code> and <code class="language-plaintext highlighter-rouge">ingredient</code>, from which we will extract new values into columns added to the dataframe later in the cleaning process.</p>

<h2 id="data-cleaning-and-exploratory-data-analysis">Data Cleaning and Exploratory Data Analysis</h2>

<h3 id="data-cleaning">Data Cleaning</h3>
<ol>
  <li>Clean the <code class="language-plaintext highlighter-rouge">RAW_recipes</code> dataframe before merge
    <ul>
      <li>Removing column <code class="language-plaintext highlighter-rouge">Unnamed: 0</code> since it does not contain any useful information.</li>
    </ul>
  </li>
  <li>
    <p>Examine the types of the <code class="language-plaintext highlighter-rouge">RAW_recipes</code> column values</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: center">column</th>
          <th style="text-align: center">type</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">name</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">id</td>
          <td style="text-align: center">int64</td>
        </tr>
        <tr>
          <td style="text-align: center">minutes</td>
          <td style="text-align: center">int64</td>
        </tr>
        <tr>
          <td style="text-align: center">contributor_id</td>
          <td style="text-align: center">int64</td>
        </tr>
        <tr>
          <td style="text-align: center">submitted</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">tags</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">nutrition</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">n_steps</td>
          <td style="text-align: center">int64</td>
        </tr>
        <tr>
          <td style="text-align: center">steps</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">description</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">ingredients</td>
          <td style="text-align: center">object</td>
        </tr>
        <tr>
          <td style="text-align: center">n_ingredients</td>
          <td style="text-align: center">int64</td>
        </tr>
      </tbody>
    </table>

    <p>We notice that the <code class="language-plaintext highlighter-rouge">nutrition</code> and <code class="language-plaintext highlighter-rouge">ingredients</code> are <code class="language-plaintext highlighter-rouge">object</code>, so we want to do transforming of these columns.</p>
  </li>
  <li>Convert each nutrition into single column
    <ul>
      <li>For <code class="language-plaintext highlighter-rouge">nutrition</code>, each row is a list-like srings storing values in the form <code class="language-plaintext highlighter-rouge">[calories (#), total fat (PDV), sugar (PDV), sodium (PDV), protein (PDV), saturated fat (PDV), carbohydrates (PDV)]</code>. Since all values are important for later investigation, we want to get access to them easier, so we:
        <ul>
          <li>remove the first and last character of the original nutrition and split the rest by ‘,’.</li>
          <li>use <code class="language-plaintext highlighter-rouge">apply</code> to get the value for each component and convert them to <code class="language-plaintext highlighter-rouge">float</code>.</li>
          <li>add new columns: <code class="language-plaintext highlighter-rouge">calories</code>, <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">sugar</code>, <code class="language-plaintext highlighter-rouge">sodium</code>, <code class="language-plaintext highlighter-rouge">protein</code>, <code class="language-plaintext highlighter-rouge">saturated_fat</code>, <code class="language-plaintext highlighter-rouge">carbohydrates</code> into <code class="language-plaintext highlighter-rouge">RAW_recipes</code>.</li>
          <li>name a new dataframe after transforming the <code class="language-plaintext highlighter-rouge">RAW_recipes</code> called <code class="language-plaintext highlighter-rouge">recipes</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Create <code class="language-plaintext highlighter-rouge">cheese</code> column to <code class="language-plaintext highlighter-rouge">recipes</code>
    <ul>
      <li>For <code class="language-plaintext highlighter-rouge">ingredients</code>, we only care about whether cheese is presense in the long string in order to invest the relationship between calories and cheese:
        <ul>
          <li>use regular expression to find term <code class="language-plaintext highlighter-rouge">cheese</code> in <code class="language-plaintext highlighter-rouge">ingredients</code>, and create a new column <code class="language-plaintext highlighter-rouge">cheese</code> with <code class="language-plaintext highlighter-rouge">boolean</code> values indicating if there is cheese in ingredients.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Merge dataframes into a dataset called <code class="language-plaintext highlighter-rouge">combine</code>
    <ul>
      <li>We left merge <code class="language-plaintext highlighter-rouge">RAW_interactions</code> to <code class="language-plaintext highlighter-rouge">recipes</code> on <code class="language-plaintext highlighter-rouge">id</code> in <code class="language-plaintext highlighter-rouge">recipes</code> and <code class="language-plaintext highlighter-rouge">recipe_id</code> in <code class="language-plaintext highlighter-rouge">RAW_interactions</code>.</li>
    </ul>
  </li>
  <li>Replace all ratings of 0.0 to <code class="language-plaintext highlighter-rouge">nan</code> in <code class="language-plaintext highlighter-rouge">combine</code>
    <ul>
      <li>Valid ratings only include 1, 2, 3, 4, 5, and ratings of 0.0 indicates that no rating is given in the interaction, which contains no actual meaning.</li>
    </ul>
  </li>
  <li>Compute average rating
    <ul>
      <li>We calculate the average rating for each recipe as new column <code class="language-plaintext highlighter-rouge">avg_rating</code>, so it can better demonstrate the overall ratings of the recipe.</li>
      <li>Merge the <code class="language-plaintext highlighter-rouge">avg_rating</code> to the <code class="language-plaintext highlighter-rouge">combine</code>.</li>
    </ul>
  </li>
</ol>

<p>After cleaning, there are 234429 rows and 26 columns in <code class="language-plaintext highlighter-rouge">combine</code>. Here we display the first five rows of the dataframe with 10 columns that will be mainly used for further investigation.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">name</th>
      <th style="text-align: center">calories</th>
      <th style="text-align: center">total_fat</th>
      <th style="text-align: center">sugar</th>
      <th style="text-align: center">sodium</th>
      <th style="text-align: center">protein</th>
      <th style="text-align: center">saturated_fat</th>
      <th style="text-align: center">carbohydrates</th>
      <th style="text-align: center">cheese</th>
      <th style="text-align: center">rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1 brownies in the world    best ever</td>
      <td style="text-align: center">138.4</td>
      <td style="text-align: center">10</td>
      <td style="text-align: center">50</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">19</td>
      <td style="text-align: center">6</td>
      <td style="text-align: center">False</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">1 in canada chocolate chip cookies</td>
      <td style="text-align: center">595.1</td>
      <td style="text-align: center">46</td>
      <td style="text-align: center">211</td>
      <td style="text-align: center">22</td>
      <td style="text-align: center">13</td>
      <td style="text-align: center">51</td>
      <td style="text-align: center">26</td>
      <td style="text-align: center">False</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">412 broccoli casserole</td>
      <td style="text-align: center">194.8</td>
      <td style="text-align: center">20</td>
      <td style="text-align: center">6</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">22</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">True</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">412 broccoli casserole</td>
      <td style="text-align: center">194.8</td>
      <td style="text-align: center">20</td>
      <td style="text-align: center">6</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">22</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">True</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">412 broccoli casserole</td>
      <td style="text-align: center">194.8</td>
      <td style="text-align: center">20</td>
      <td style="text-align: center">6</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">22</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">True</td>
      <td style="text-align: center">5</td>
    </tr>
  </tbody>
</table>

<h3 id="univariate-analysis">Univariate Analysis</h3>
<p>First, we will examine the distribution of  calories from the <code class="language-plaintext highlighter-rouge">recipes</code> dataframe.</p>

<iframe src="assets/hist_calories_total.html" width="800" height="450" frameborder="0"></iframe>

<p>But as one can see from the plot, the distribution mostly concentrates on the very left. The outliers at the right tail makes the distribution hard to be examined.</p>

<p>Then we remove the outliers to focus on values less and equal to 990.</p>

<iframe src="assets/hist_calories.html" width="800" height="450" frameborder="0"></iframe>

<p>By removing the outliers in the histogram, we can more clearly observe that the distribution is skewed to the left, with the majority of data concentrated between 50 and 400 calories, and a peak at around 180. This is quite surprising, as the distribution suggests that more recipes promoting a healthy diet have been published. After the peak there is a decrease of the count of recipes, corresponding with higher calories.</p>

<h3 id="bivariate-analysis">Bivariate Analysis</h3>
<p>For bivariate analysis, we will examine the distribution of calories with and without cheese, also with outliers removed to better visualization.</p>

<iframe src="assets/fig_with_without_cheese.html" width="900" height="500" frameborder="0"></iframe>

<p>We can see that both distributions skew to the left, but the peak of distribution of calories without cheese is on the left of the distribution with cheese, indicating that calories of recipes with cheese may be higher than calories of those without cheese. We will further investigate in later sections on whether having cheese in recipes tend to have higher calories.</p>

<h3 id="grouping-and-aggregates">Grouping and Aggregates</h3>
<p>An interesting aggregate that we find is shown in the pivot table below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Year</th>
      <th style="text-align: center">(‘diff_prop’, 1.0)</th>
      <th style="text-align: center">(‘diff_prop’, 2.0)</th>
      <th style="text-align: center">(‘diff_prop’, 3.0)</th>
      <th style="text-align: center">(‘diff_prop’, 4.0)</th>
      <th style="text-align: center">(‘diff_prop’, 5.0)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">2008</td>
      <td style="text-align: center">0.04</td>
      <td style="text-align: center">0.03</td>
      <td style="text-align: center">0.03</td>
      <td style="text-align: center">0.03</td>
      <td style="text-align: center">0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2009</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">0.03</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2010</td>
      <td style="text-align: center">0</td>
      <td style="text-align: center">0.04</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2011</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2012</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">0.02</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2013</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">0</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2014</td>
      <td style="text-align: center">0.03</td>
      <td style="text-align: center">0.01</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">0</td>
    </tr>
    <tr>
      <td style="text-align: center">2015</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0</td>
    </tr>
    <tr>
      <td style="text-align: center">2016</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0</td>
    </tr>
    <tr>
      <td style="text-align: center">2017</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.04</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0.01</td>
    </tr>
    <tr>
      <td style="text-align: center">2018</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.02</td>
      <td style="text-align: center">-0.01</td>
      <td style="text-align: center">-0</td>
      <td style="text-align: center">-0.01</td>
    </tr>
  </tbody>
</table>

<p><br />
The pivot table is aimed to examine the <code class="language-plaintext highlighter-rouge">diff_prop</code> which is calculated by <code class="language-plaintext highlighter-rouge">prop_cheese_recipes - prop_nocheese_recipes</code> across years from 2008 to 2018, given the level of rating. Positive values indicate there are more recipes with cheese, and on the other hand negative values indicate more recipes without cheese.</p>

<h2 id="assessment-of-missingness">Assessment of Missingness</h2>

<h3 id="nmar-analysis">NMAR Analysis</h3>
<p>We believe the missingness in the <code class="language-plaintext highlighter-rouge">review column</code> is NMAR. There are a few possible reasons for people not to fill in the review section. For example, people tend not to post reviews if they feel neutural or nothing special about the recipes, and thus choose not to take extra steps wrting the reviews and publish on the site. Also, it is less likely for people to write reviews if they have negative experience with the recipes, either because they want to avoid conflicts against those who like the food, or it is worth wasting their time doing so. On the other hand, people who like the recipes or have anything interesting to share tend to leave comments. Thus the missingess depends on the values of the <code class="language-plaintext highlighter-rouge">review</code> column, making it NMAR.</p>

<p>We could obtain additional data to to make the missingness MAR. One possible approach is to send out polls through personal emails provided during registration process, or communicate through messages on the Food website, to ask if they could share their experience with the recipes and reason why they don’t want to write reviews.</p>

<h3 id="missingness-dependency">Missingness Dependency</h3>

<p>In this part, we will examine the missingness dependency between <code class="language-plaintext highlighter-rouge">rating</code> and the other two columns, using permutation tests.</p>

<p>The first two columns that we want to focus on are <code class="language-plaintext highlighter-rouge">calories</code> and <code class="language-plaintext highlighter-rouge">rating</code>, and we want to determine whether the missingness in <code class="language-plaintext highlighter-rouge">rating</code> is dependent on distribution of <code class="language-plaintext highlighter-rouge">calories</code>.</p>

<p><strong>Null Hypothesis</strong>: the distribution of  <code class="language-plaintext highlighter-rouge">calories</code> is the same when <code class="language-plaintext highlighter-rouge">rating</code> is missing and not missing.</p>

<p><strong>Alternative Hypothesis</strong>: the distribution of <code class="language-plaintext highlighter-rouge">calories</code> is not the same when <code class="language-plaintext highlighter-rouge">rating</code> is missing and not missing.</p>

<p>Before performing the permutation test, we want to visualize the distribution of calories for recipes missing and not missing.</p>

<iframe src="assets/rating_calories_total_2.html" width="1000" height="500" frameborder="0"></iframe>

<p>But because there are a lot of outliers in <code class="language-plaintext highlighter-rouge">calories</code>, the values are compressed to the left and make the distributions hard to see. So we remove the outliers and generate another plot as shown below.</p>

<iframe src="assets/rating_calories_no_outleirs.html" width="1000" height="500" frameborder="0"></iframe>

<p>The shape of two distributions look similar, so we will use <strong>permutation test</strong> with <strong>absolute value of difference in means</strong> as our test statistics, and the rejection threshold is <strong>0.05</strong>.</p>

<p>In the permutation test, we shuffle the <code class="language-plaintext highlighter-rouge">calories</code> column and calculate the test statstics for 1000 times. Then we plot the distribution of the calculated statistics and the observed one.</p>

<iframe src="assets/permu_test_1.html" width="900" height="500" frameborder="0"></iframe>

<p>Since the p value is less than 0.05 and as small as 0, we have strong evidence to reject the null hypothesis and say that the distribution for <code class="language-plaintext highlighter-rouge">calories</code> is different for missing and not missing <code class="language-plaintext highlighter-rouge">rating</code>. Thus missingness in <code class="language-plaintext highlighter-rouge">rating</code> is MAR, dependent on <code class="language-plaintext highlighter-rouge">calories</code>.</p>

<p><br />
Then we want to see if the missingness in rating is dependent on the time spent on cooking, or <code class="language-plaintext highlighter-rouge">minutes</code> in the <code class="language-plaintext highlighter-rouge">combine</code> dataframe.</p>

<p><strong>Null hypothesis</strong>: the distribution of <code class="language-plaintext highlighter-rouge">minutes</code> is the same when <code class="language-plaintext highlighter-rouge">rating</code> is missing and not missing.</p>

<p><strong>Alternative hypothesis</strong>: the distribution of <code class="language-plaintext highlighter-rouge">minutes</code> is not the same when <code class="language-plaintext highlighter-rouge">rating</code> is missing and not missing.</p>

<p>We visualize the two distributions to determine type of test to perform. We also exclude outliers in <code class="language-plaintext highlighter-rouge">minutes</code> to make it clearer to see.</p>

<iframe src="assets/rating_minutes_no_outliers.html" width="900" height="500" frameborder="0"></iframe>

<p>From the histogram we notice that two distributions have similar shape. Thus we would use <strong>permutation test</strong> with <strong>absolute values in means</strong> as test statistics, or the mean of <code class="language-plaintext highlighter-rouge">minutes</code> when <code class="language-plaintext highlighter-rouge">rating</code> is missing and not missing. The significance level is <strong>0.05</strong>.</p>

<iframe src="assets/permu_test_2.html" width="900" height="450" frameborder="0"></iframe>

<p>The p_value from the permutation test is 0.14, which is greater than the threshold of 0.05. We fail to reject the null hypothesis to say that the two distributions of <code class="language-plaintext highlighter-rouge">minutes</code> are different when rating is missing and not missing. Thus the missingness of <code class="language-plaintext highlighter-rouge">rating</code> is not dependent on <code class="language-plaintext highlighter-rouge">minutes</code>.</p>

<h2 id="hypothesis-testing">Hypothesis Testing</h2>

<p>Recalling the goal of our project, we will investigate whether the amount of calories in a recipe is larger when there is cheese in the ingredients. The columns we will use are <code class="language-plaintext highlighter-rouge">calories</code> and <code class="language-plaintext highlighter-rouge">cheese</code>. We decided to test our hypothesis using a permutation test.</p>

<p><strong>Null Hypothesis</strong>: the amount of calories for a recipe with cheese is the same as the amount of calories without cheese.</p>

<p><strong>Alternative Hypothesis</strong>: the amount of calories for a recipe with cheese is the greater than the amount of calories without cheese.</p>

<p><strong>Test Statistic</strong>: mean calories with cheese - mean calories without cheese.</p>

<p><strong>Significance Level</strong>: 0.05</p>

<p>For test statistics, a large value in (mean calories with cheese - mean calories without cheese) will imply that more calories in a recipe  with cheese than recipes without cheese.</p>

<p>In our permutation test we randomly shuffle calories and assign them to recipes for 1000 times to generate an empirical distribution of the test statistics. We find p value is 0.0, which means none of our randomly generated difference is larger than the observed statistic. Therefore, we have strong evidence to reject the null hypothesis and suggest that recipes with cheese would have higher calories.</p>

<iframe src="assets/hypothesis.html" width="800" height="450" frameborder="0"></iframe>

<h2 id="framing-a-prediction">Framing a Prediction</h2>

<p>We plan to predict the amount of calories for each recipe using a linear regression model as <code class="language-plaintext highlighter-rouge">calories</code> are continous variable. It is hard to predict the amount of calories as a quantitative value by classification.</p>

<p>The reason we choose to use <code class="language-plaintext highlighter-rouge">calories </code>as our prediction target is that it is an important factor in deciding whether to use a recipe for a meal. Recipes with too many calories may raise health concerns, while recipes with too few calories may not be able to maintain our daily activities. From our earlier investigation, we  found that the presence of cheese in a recipe correlates with calory values. As an ingredient rich in nutrients like calcium, protein, and fat, we wonder what the key nutrients play a significant role in determining calories. Thus, we want to predict calorie amounts based on the presence of cheese and other nutritional features.</p>

<p>We evaluated our model using Root Mean Squared Error (<code class="language-plaintext highlighter-rouge">RMSE</code>). It is a more direct value to assess the errors in the test set, making it easy to interpret. Also, we can compare <code class="language-plaintext highlighter-rouge">RMSE</code> of testing and training set to examine if the model is overfitting, resulting in a dataframe that can generalize better. It is very important for our model because the values of our features, the nutritions, can vary a lot in real world. Compared to <code class="language-plaintext highlighter-rouge">RMSE</code>, R<sup>2</sup> only tells us how the linear model fit the existed dataset, with less power to generalize.</p>

<p>At the point of prediction, we information about values of different nutritions used in recipes from the <code class="language-plaintext highlighter-rouge">nutritions</code> column, and we also know the prescence of from the <code class="language-plaintext highlighter-rouge">cheese</code> column created from <code class="language-plaintext highlighter-rouge">ingredients</code>. We will use them as features in our regression model.</p>

<h2 id="baseline-model">Baseline Model</h2>

<p>In our baseline model, we want to use linear regression to predict the amount of calories, a quantitative value. We use features in <code class="language-plaintext highlighter-rouge">recipes</code> dataframe, including <code class="language-plaintext highlighter-rouge">total_fat</code> and <code class="language-plaintext highlighter-rouge">sugar</code>. All features here (<code class="language-plaintext highlighter-rouge">calories</code>, <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">sugar</code>) are quantitative and continuous, so we don’t need to do any transformation here and can use them directly in the <code class="language-plaintext highlighter-rouge">LinearRegression()</code> function. The data is split into training and testing sets with ratios of 0.8 and 0.2.</p>

<p>The <code class="language-plaintext highlighter-rouge">RMSE</code> of the train set is 203.8 and the <code class="language-plaintext highlighter-rouge">RMSE</code> of the test set is 196.2. The similar performance on the training and testing sets indicates that there is no significant overfitting. However, the <code class="language-plaintext highlighter-rouge">RMSE</code> of approximately 200 calories is relatively high, so we still need to improve our model. Besides, the model uses only two features (<code class="language-plaintext highlighter-rouge">total_fat</code> and <code class="language-plaintext highlighter-rouge">sugar</code>), all directly put into the <code class="language-plaintext highlighter-rouge">LinearRegression()</code> function. So we should be able to improve the model performance by carefully choosing features and trying some transformation.</p>

<h2 id="final-model">Final Model</h2>

<p>We consider all columns of nutritions (<code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">sugar</code>, <code class="language-plaintext highlighter-rouge">sodium</code>, <code class="language-plaintext highlighter-rouge">protein</code>, <code class="language-plaintext highlighter-rouge">saturated_fat</code>, <code class="language-plaintext highlighter-rouge">carbohydrates</code>) as features that may contribute to improvement of our prediction model, because calories scientifically are derived from macronutrients (fats, proteins, and carbohydrates) and other nutritional components. By including these features, we are able to capture more primary sources of calories in recipes, making features more relevant for our target value. In addition, we also include <code class="language-plaintext highlighter-rouge">cheese</code> because it is a calorie-dense ingredient, and its presence in a recipe is likely to impact the total calorie count, supported by evidence from our hypothesis test. Including this feature allows the model to account for the additional calories contributed by cheese.</p>

<p>We use Linear regression to make the prediction. To optimize the model, we performed hyperparameter tuning using <code class="language-plaintext highlighter-rouge">GridSearchCV</code> and find that the best hyperparameter is <code class="language-plaintext highlighter-rouge">True</code> for <code class="language-plaintext highlighter-rouge">fit_intercept</code> and <code class="language-plaintext highlighter-rouge">False</code> for <code class="language-plaintext highlighter-rouge">positive</code>.</p>

<p>To improve the model’s performance, we experimented with different combinations of features and transformations:</p>
<ul>
  <li>We tried combinations of degree one of features, and found <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">protein</code>, <code class="language-plaintext highlighter-rouge">carbohydrates</code> and <code class="language-plaintext highlighter-rouge">cheese</code> performed best.</li>
  <li>We tried applying <code class="language-plaintext highlighter-rouge">QuantileTransform</code> to different combination of features, and it largely increases our <code class="language-plaintext highlighter-rouge">RMSE</code>, from 196 for the baseline model to 486.72 on test set. Thus <code class="language-plaintext highlighter-rouge">QuantileTransform</code>is not a good transformer for our model.</li>
</ul>

<p>Then we wondered if higher degrees in our regression model would give a better result, so we tried adding different combinations of features of degree 2 to <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">protein</code>, <code class="language-plaintext highlighter-rouge">carbohydrates</code> and <code class="language-plaintext highlighter-rouge">cheese</code>. The result we got is the list of features <code class="language-plaintext highlighter-rouge">curr_best_features = [carbohydrates^2, carbohydrates, total_fat, protein, cheese]</code> that achieved the smallest <code class="language-plaintext highlighter-rouge">RMSE</code>.</p>

<p>We further tried different combinations of features of degree 2 and 3 and add them to <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">protein</code>, <code class="language-plaintext highlighter-rouge">carbohydrates</code> and <code class="language-plaintext highlighter-rouge">cheese</code> of degree</p>
<ul>
  <li>We failed to achieve better result than <code class="language-plaintext highlighter-rouge">curr_best_features</code>.</li>
  <li>We stopped at degree 3 because as none in degree 3 outperforming orginal combination, it is unlikely we will find a better combination in degree 4. We can also see that when we try different <code class="language-plaintext highlighter-rouge">d</code> (in <code class="language-plaintext highlighter-rouge">range(4)</code>) for <code class="language-plaintext highlighter-rouge">PolynomialFeatures(d)</code>, degree 1 achieves smallest RMSE for test set.</li>
</ul>

<p>So our final model is a linear regression using <code class="language-plaintext highlighter-rouge">curr_best_features = [carbohydrates^2, carbohydrates, total_fat, protein, cheese]</code>, in which <code class="language-plaintext highlighter-rouge">carbohydrates</code>, <code class="language-plaintext highlighter-rouge">total_fat</code>, <code class="language-plaintext highlighter-rouge">protein</code> are quantitative values that don’t need further transformation. <code class="language-plaintext highlighter-rouge">cheese</code> is booleans but since the program takes <code class="language-plaintext highlighter-rouge">True</code> as 1 and <code class="language-plaintext highlighter-rouge">False</code> as 0, it also don’t need further transformation. <code class="language-plaintext highlighter-rouge">carbohydrates</code> with degree 2 is achieved by applying <code class="language-plaintext highlighter-rouge">make_column_transformer</code>.</p>

<p>The final model performs better than baseline model. It achieves <code class="language-plaintext highlighter-rouge">RMSE</code> of 48.40 for train set and of 43.58 for test set.</p>

<h2 id="fairness-analysis">Fairness Analysis</h2>

<p>For fairness analysis, we split the data into two groups: recipes with low sugar (less or equal to 23) and recipes with high sugar (more than 23). We pick 23 as the split point because it is the median of sugar in the <code class="language-plaintext highlighter-rouge">recipes</code> dataset. Since we use a linear regression model, we decide to use <code class="language-plaintext highlighter-rouge">RMSE</code> as our evaluation metric. It is easier to understand compared to R<sup>2</sup> and it is better to keep a consistency with the elavuation metric we used during model prediction.</p>

<p>To check the p value, we use permutation testing here. For each recipe we list their actual calories and predicted calories. Then we can calculate squared error for each recipe. By calculating the square root of mean value for each group (low sugar and high sugar), we first created a column called <code class="language-plaintext highlighter-rouge">X_test_high</code> using <code class="language-plaintext highlighter-rouge">Binarizer</code> transformer to determine if the value of sugar in the test set is above 23. Then for a 1000 times, we calculated two <code class="language-plaintext highlighter-rouge">RMSE</code> values and so their difference. We shuffled <code class="language-plaintext highlighter-rouge">X_test_high</code> and re-calculate the <code class="language-plaintext highlighter-rouge">RMSE</code> and their differences, storing in a <code class="language-plaintext highlighter-rouge">stats</code> list.</p>

<p><strong>Null hypothesis</strong>: Our model is fair. It predicts calories for recipes with low sugar and high sugar with similar RMSE.</p>

<p><strong>Alternative hypothesis</strong>: our model is biased. It predicts calories for recipes with high sugar with higher RMSE than recipes with low sugar.</p>

<p><strong>Test statistic</strong>: RMSE of recipes with high sugar-RMSE of recipes with low sugar</p>

<p><strong>Significance level</strong>: 0.05</p>

<iframe src="assets/sugar_fair.html" width="800" height="450" frameborder="0"></iframe>

<p>As a result, we get a p value of 0.201, which is larger than the significance level. We don’t have enough evidence to reject the null hypothesis. It implies that our model results in similar performance in predicting calories when the amount of sugar is low and high.</p>

<p>We also want to see if our prediction is fair for predicting cheese. More specifically, if our prediction is fair for recipes with cheese and without cheese. Similarly, we use <code class="language-plaintext highlighter-rouge">RMSE</code> as an evaluation metric and permutation test to simulate the difference in random state.<br />
We run a permutation test in a similar way as we did in fairness analysis for sugar. The only difference is that instead of grouping recipes based on sugar, we group them based on the existence of cheese.</p>

<p><strong>Null hypothesis</strong>: Our model is fair. It predicts calories for recipes with and without cheese with similar RMSE.</p>

<p><strong>Alternative hypothesis</strong>: our model is biased. It predicts calories for recipes without cheese with higher RMSE than recipes with cheese.</p>

<p><strong>Test statistic</strong>: RMSE of recipes with cheese - RMSE of recipes without cheese</p>

<p><strong>Significance level</strong>: 0.05</p>

<iframe src="assets/cheese_fair.html" width="800" height="500" frameborder="0"></iframe>

<p>As a result, we get a p value of 0.0, which is much lower than the significance level, so we reject the null hypothesis. The result implies that our model is unfair. It predicts calories for recipes without cheese with higher RMSE than recipes with cheese.</p>

        </section>

        <aside id="sidebar">
          

          
            <p class="repo-owner"><a href="https://github.com/szhcoco/Investigation-on-Cheese-and-Calories">Investigation-on-Cheese-and-Calories</a> is maintained by <a href="https://github.com/szhcoco">szhcoco</a>.</p>
          

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>
        </aside>
      </div>
    </div>

  </body>
</html>
